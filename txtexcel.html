<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محول النصوص إلى Excel</title>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 0;
            padding: 20px;
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50, #4a69bd);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        
        .logo {
            position: absolute;
            top: 20px;
            left: 25px;
            font-size: 2rem;
        }
        
        h1 {
            margin: 0;
            font-size: 2.2rem;
        }
        
        .description {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 15px auto;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            padding: 25px;
            gap: 25px;
        }
        
        .input-section {
            width: 100%;
        }
        
        .section-title {
            background: linear-gradient(135deg, #4a69bd, #6a89cc);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin-top: 0;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            padding: 18px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            border-color: #4a69bd;
            outline: none;
        }
        
        .buttons-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 25px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        button {
            padding: 14px 22px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4a69bd, #6a89cc);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #3c58a8, #5d78b5);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #219653, #27ad5f);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #f1c40f);
            color: white;
        }
        
        .btn-warning:hover {
            background: linear-gradient(135deg, #e67e22, #f39c12);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #ff6b6b);
            color: white;
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #c0392b, #ee5a5a);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .btn-excel {
            background: linear-gradient(135deg, #1d6f42, #27ae60);
            color: white;
            padding: 14px 25px;
            font-size: 1.1rem;
        }
        
        .btn-excel:hover {
            background: linear-gradient(135deg, #166336, #219653);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        }
        
        .table-container-wrapper {
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .table-controls {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }
        
        .zoom-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .zoom-controls button {
            padding: 8px 12px;
            font-size: 1.2rem;
        }
        
        .zoom-level {
            font-weight: bold;
            color: #4a69bd;
        }
        
        .table-container {
            width: 100%;
            overflow: auto;
            max-height: 400px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            transform-origin: top right;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 14px;
            text-align: center;
            transition: background-color 0.2s;
            max-width: 250px;
            position: relative;
        }
        
        th {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            font-weight: bold;
            color: #444;
            position: relative;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        tr:hover {
            background-color: #f1f7ff;
        }
        
        td:hover {
            background-color: #e6f0ff;
        }
        
        .cell-content {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: block;
            width: 100%;
        }
        
        td[contenteditable="true"] .cell-content {
            white-space: normal;
            overflow: visible;
            text-overflow: clip;
        }
        
        .delete-btn {
            color: #e74c3c;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.3rem;
            transition: all 0.2s;
            padding: 5px 10px;
            border-radius: 4px;
        }
        
        .delete-btn:hover {
            background-color: #ffecec;
            transform: scale(1.2);
        }
        
        .footer {
            text-align: center;
            padding: 25px;
            background-color: #f8f9fa;
            border-top: 1px solid #ddd;
            margin-top: 20px;
            font-size: 1rem;
            color: #666;
        }
        
        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            background-color: #ffeaa7;
            color: #d35400;
            display: none;
        }
        
        .counters-container {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .counter-box {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 12px 18px;
            border-radius: 8px;
            flex: 1;
            min-width: 150px;
            text-align: center;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .counter-title {
            font-size: 0.9rem;
            color: #1565c0;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .counter-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #0d47a1;
        }
        
        .table-info {
            background-color: #e3f2fd;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-info span {
            font-weight: bold;
            color: #1565c0;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @media (max-width: 768px) {
            .buttons-container {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
            
            .notification {
                left: 20px;
                right: 20px;
                text-align: center;
            }
            
            .table-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .counters-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="notification" id="notification"></div>
    
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-table"></i>
            </div>
            <h1>محول النصوص إلى جدول Excel</h1>
            <p class="description">أدخل النص حيث يمثل كل سطر عمودًا في Excel، مع إمكانية إضافة عدة صفوف بشكل منفصل</p>
        </header>
        
        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title"><i class="fas fa-keyboard"></i> مدخلات النص</h2>
                
                <textarea id="textInput" placeholder="أدخل النص هنا... كل سطر سيكون عمودًا في Excel&#10;استخدم سطرًا فارغًا لفصل بين الصفوف" oninput="updateLineCount()"></textarea>
                
                <div class="counters-container">
                    <div class="counter-box">
                        <div class="counter-title">عدد الأسطر</div>
                        <div class="counter-value" id="lineCount">0</div>
                    </div>
                    <div class="counter-box">
                        <div class="counter-title">عدد الصفوف</div>
                        <div class="counter-value" id="rowDetected">0</div>
                    </div>
                </div>
            </div>
            
            <div class="buttons-container">
                <button class="btn-success" onclick="addAsNewRow()">
                    <i class="fas fa-plus-circle"></i> إضافة كصف جديد
                </button>
                <button class="btn-warning" onclick="pasteText()">
                    <i class="fas fa-paste"></i> لصق النص
                </button>
                <button class="btn-danger" onclick="clearAll()">
                    <i class="fas fa-trash-alt"></i> مسح الكل
                </button>
                <button class="btn-excel" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i> تحميل ملف Excel
                </button>
            </div>
            
            <div class="output-section">
                <h2 class="section-title"><i class="fas fa-table"></i> الجدول الناتج</h2>
                
                <div class="table-info">
                    <div>عدد الصفوف: <span id="rowCount">0</span></div>
                    <div>عدد الأعمدة: <span id="colCount">0</span></div>
                </div>
                
                <div class="table-container-wrapper">
                    <div class="table-controls">
                        <div class="zoom-controls">
                            <button class="btn-primary" onclick="zoomOut()" title="تصغير">
                                <i class="fas fa-search-minus"></i>
                            </button>
                            <span class="zoom-level" id="zoomLevel">100%</span>
                            <button class="btn-primary" onclick="zoomIn()" title="تكبير">
                                <i class="fas fa-search-plus"></i>
                            </button>
                        </div>
                        <div>
                            <button class="btn-primary" onclick="resetZoom()" title="إعادة الضبط">
                                <i class="fas fa-sync-alt"></i> إعادة الضبط
                            </button>
                        </div>
                    </div>
                    <div class="table-container" id="tableScrollContainer">
                        <div id="tableContainer">
                            <p style="text-align: center; padding: 30px; color: #666; background-color: #f9f9f9; border-radius: 8px;">
                                سيظهر الجدول هنا بعد إضافة الصفوف
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>محول النصوص إلى Excel - إضافة متعددة</p>
        </div>
    </div>

    <script>
        // بيانات الجدول
        let tableData = [];
        let maxColumns = 0;
        let zoomLevel = 100;
        
        // تحديث عداد الأسطر
        function updateLineCount() {
            const textInput = document.getElementById('textInput');
            const text = textInput.value;
            
            // حساب عدد الأسطر
            const lines = text.split('\n').filter(line => line.trim() !== '');
            document.getElementById('lineCount').textContent = lines.length;
            
            // حساب عدد الصفوف المكتشفة (بناءً على الأسطر الفارغة)
            const rows = detectRowsFromText(text);
            document.getElementById('rowDetected').textContent = rows.length;
        }
        
        // اكتشاف الصفوف من النص بناءً على الأسطر الفارغة
        function detectRowsFromText(text) {
            if (!text.trim()) return [];
            
            // تقسيم النص إلى أقسام بناءً على الأسطر الفارغة
            const sections = text.split(/\n\s*\n/);
            const rows = [];
            
            sections.forEach(section => {
                if (section.trim()) {
                    const lines = section.split('\n').filter(line => line.trim() !== '');
                    if (lines.length > 0) {
                        rows.push(lines);
                    }
                }
            });
            
            return rows;
        }
        
        // عرض التنبيه
        function showAlert(message, type = 'info') {
            const alertBox = document.getElementById('alertBox');
            alertBox.textContent = message;
            alertBox.style.display = 'block';
            
            if (type === 'error') {
                alertBox.style.backgroundColor = '#ffecec';
                alertBox.style.color = '#c0392b';
            } else {
                alertBox.style.backgroundColor = '#e3f2fd';
                alertBox.style.color = '#1565c0';
            }
            
            setTimeout(() => {
                alertBox.style.display = 'none';
            }, 5000);
        }
        
        // عرض إشعار
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // لصق النص من الحافظة
        async function pasteText() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('textInput').value = text;
                updateLineCount();
                showNotification('تم لصق النص بنجاح');
            } catch (err) {
                showAlert('تعذر الوصول إلى الحافظة. يرجى استخدام Ctrl+V', 'error');
            }
        }
        
        // تكبير الجدول
        function zoomIn() {
            if (zoomLevel < 150) {
                zoomLevel += 10;
                updateZoom();
            }
        }
        
        // تصغير الجدول
        function zoomOut() {
            if (zoomLevel > 50) {
                zoomLevel -= 10;
                updateZoom();
            }
        }
        
        // إعادة ضبط التكبير/التصغير
        function resetZoom() {
            zoomLevel = 100;
            updateZoom();
        }
        
        // تطبيق مستوى التكبير/التصغير
        function updateZoom() {
            const table = document.querySelector('table');
            if (table) {
                table.style.transform = `scale(${zoomLevel / 100})`;
                document.getElementById('zoomLevel').textContent = `${zoomLevel}%`;
            }
        }
        
        // إضافة النص كصف جديد
        function addAsNewRow() {
            const textInput = document.getElementById('textInput');
            const text = textInput.value.trim();
            
            if (!text) {
                showAlert('يرجى إدخال نص أولاً', 'error');
                return;
            }
            
            // اكتشاف الصفوف من النص (بناءً على الأسطر الفارغة)
            const detectedRows = detectRowsFromText(text);
            
            if (detectedRows.length === 0) {
                showAlert('لا يوجد محتوى نصي لإضافته', 'error');
                return;
            }
            
            // إضافة جميع الصفوف المكتشفة
            detectedRows.forEach(row => {
                tableData.push(row);
                // تحديث عدد الأعمدة الأقصى
                maxColumns = Math.max(maxColumns, row.length);
            });
            
            // إعادة عرض الجدول
            renderTable();
            
            // مسح حقل الإدخال
            textInput.value = '';
            document.getElementById('lineCount').textContent = '0';
            document.getElementById('rowDetected').textContent = '0';
            
            // عرض إشعار بإضافة الصف
            showNotification(`تم إضافة ${detectedRows.length} صفوف جديدة بنجاح`);
            
            // تحديث عدد الصفوف والأعمدة
            updateTableInfo();
        }
        
        // تحديث معلومات الجدول
        function updateTableInfo() {
            document.getElementById('rowCount').textContent = tableData.length;
            document.getElementById('colCount').textContent = maxColumns;
        }
        
        // عرض الجدول
        function renderTable() {
            const tableContainer = document.getElementById('tableContainer');
            
            if (tableData.length === 0) {
                tableContainer.innerHTML = '<p style="text-align: center; padding: 30px; color: #666; background-color: #f9f9f9; border-radius: 8px;">سيظهر الجدول هنا بعد إضافة الصفوف</p>';
                updateTableInfo();
                return;
            }
            
            let tableHTML = '<table><thead><tr>';
            
            // إنشاء الرأس
            for (let i = 0; i < maxColumns; i++) {
                tableHTML += `<th>العمود ${i+1}</th>`;
            }
            tableHTML += '<th>إجراءات</th></tr></thead><tbody>';
            
            // إنشاء الصفوف
            for (let rowIndex = 0; rowIndex < tableData.length; rowIndex++) {
                tableHTML += '<tr>';
                
                for (let colIndex = 0; colIndex < maxColumns; colIndex++) {
                    const value = tableData[rowIndex][colIndex] || '';
                    tableHTML += `<td contenteditable="true" onblur="updateCell(${rowIndex}, ${colIndex}, this.innerText)">
                        <span class="cell-content">${value}</span>
                    </td>`;
                }
                
                tableHTML += `<td><span class="delete-btn" onclick="deleteRow(${rowIndex})" title="حذف الصف"><i class="fas fa-trash-alt"></i></span></td>`;
                tableHTML += '</tr>';
            }
            
            tableHTML += '</tbody></table>';
            tableContainer.innerHTML = tableHTML;
            
            // إضافة event listeners للخلايا القابلة للتحرير
            const editableCells = tableContainer.querySelectorAll('td[contenteditable="true"]');
            editableCells.forEach(cell => {
                cell.addEventListener('focus', function() {
                    this.querySelector('.cell-content').style.whiteSpace = 'normal';
                    this.querySelector('.cell-content').style.overflow = 'visible';
                    this.querySelector('.cell-content').style.textOverflow = 'clip';
                });
                
                cell.addEventListener('blur', function() {
                    this.querySelector('.cell-content').style.whiteSpace = 'nowrap';
                    this.querySelector('.cell-content').style.overflow = 'hidden';
                    this.querySelector('.cell-content').style.textOverflow = 'ellipsis';
                });
            });
            
            // تطبيق مستوى التكبير الحالي
            updateZoom();
            
            // تحديث معلومات الجدول
            updateTableInfo();
        }
        
        // تحديث خلية في الجدول
        function updateCell(row, col, value) {
            if (!tableData[row]) {
                tableData[row] = [];
            }
            
            // التأكد من أن الصف يحتوي على عدد كاف من الأعمدة
            while (tableData[row].length <= col) {
                tableData[row].push('');
            }
            
            tableData[row][col] = value;
            
            // تحديث عدد الأعمدة الأقصى إذا لزم الأمر
            if (col + 1 > maxColumns) {
                maxColumns = col + 1;
                renderTable();
            }
        }
        
        // حذف صف
        function deleteRow(rowIndex) {
            if (confirm('هل أنت متأكد من أنك تريد حذف هذا الصف؟')) {
                tableData.splice(rowIndex, 1);
                
                // إعادة حساب عدد الأعمدة الأقصى
                maxColumns = tableData.length > 0 ? Math.max(...tableData.map(row => row.length)) : 0;
                
                renderTable();
                showNotification('تم حذف الصف بنجاح');
            }
        }
        
        // مسح الكل
        function clearAll() {
            if (confirm('هل أنت متأكد من أنك تريد مسح كل البيانات؟')) {
                tableData = [];
                maxColumns = 0;
                document.getElementById('textInput').value = '';
                document.getElementById('lineCount').textContent = '0';
                document.getElementById('rowDetected').textContent = '0';
                renderTable();
                showNotification('تم مسح جميع البيانات بنجاح');
            }
        }
        
        // تصدير إلى Excel
        function exportToExcel() {
            if (tableData.length === 0) {
                showAlert('لا توجد بيانات لتصديرها', 'error');
                return;
            }
            
            try {
                // إنشاء نسخة من البيانات مع تعبئة الصفوف التي تحتوي على أعمدة أقل
                const exportData = tableData.map(row => {
                    const newRow = [...row];
                    while (newRow.length < maxColumns) {
                        newRow.push('');
                    }
                    return newRow;
                });
                
                // إعداد البيانات للتصدير
                const ws = XLSX.utils.aoa_to_sheet(exportData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "البيانات");
                
                // حفظ الملف
                XLSX.writeFile(wb, "الجدول_المحول.xlsx");
                showNotification('تم تصدير الملف بنجاح. سيبدأ التحميل الآن.');
            } catch (error) {
                showAlert('حدث خطأ أثناء تصدير الملف: ' + error.message, 'error');
            }
        }
        
        // تهيئة أولية
        document.getElementById('textInput').focus();
    </script>
</body>
</html>
