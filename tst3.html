<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAY (معدل)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* زيادة حجم نص التطبيق بنسبة 150% (من 16px إلى 24px) */
        :root {
            --base-font-size: 24px; /* 150% من 16px */
        }
        html, body {
            height: 100%;
        }
        body {
            font-size: var(--base-font-size);
            background: #e0e0e0;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            direction: rtl;
        }
        /* تكبير الواجهة لتغطي الصفحة */
        .container {
            width: calc(100% - 40px);
            max-width: none;
            height: calc(100vh - 40px);
            background: white;
            border-radius: 14px;
            box-shadow: 0 14px 40px rgba(0,0,0,0.25);
            overflow: auto;
            margin: 0;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        header {
            background: #2e7d52;
            color: white;
            padding: 26px 16px;
            text-align: center;
            flex: 0 0 auto;
        }
        .header-icon {
            margin-bottom: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 56px;
            filter: drop-shadow(0 4px 12px #ffd70099);
        }
        h1 { font-size: 36px; margin-bottom: 3px; font-weight: bold;}
        .content-wrap {
            padding: 20px 26px 40px 26px;
            flex: 1 1 auto;\            overflow: auto;
        }
        .progress-slider-bar {
            width: 100%;
            margin: 18px 0 12px 0;
            padding: 0 7px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            flex-direction: row;
        }
        .slider-labels { width: 36px; text-align: center; color: #2e7d52; font-weight: bold; font-size: 18px; }
        .slider {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 14px;
            background: #e0e0e0;
            border-radius: 10px;
            outline: none;
            position: relative;
            z-index: 1;
            direction: rtl;
        }
        .slider::-webkit-slider-runnable-track {
            height: 14px;
            background: linear-gradient(
                to left,
                #2e7d52 0,
                #2e7d52 var(--progress,0%),
                #e0e0e0 var(--progress,0%),
                #e0e0e0 100%
            );
            border-radius: 10px;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 34px;
            height: 34px;
            border-radius: 50%;
            background: #2e7d52;
            border: 3px solid #fff;
            cursor: pointer;
            box-shadow: 0 3px 12px #aaa;
            margin-top: -10px;
            transition: background 0.2s;
            z-index: 2;
            position: relative;
        }
        .slider:focus { outline: none; }
        .slider::-moz-range-thumb { width: 34px; height: 34px; border-radius: 50%; background: #2e7d52; border: 3px solid #fff; box-shadow: 0 3px 12px #aaa; }
        .slider::-moz-range-track { height: 14px; background: linear-gradient(to left,#2e7d52 0,#2e7d52 var(--progress,0%),#e0e0e0 var(--progress,0%),#e0e0e0 100%); border-radius: 10px; }

        .subject-selection { padding: 18px; text-align: center;}
        .selection-container {
            display: flex; justify-content: center; gap: 16px; flex-wrap: wrap; margin: 14px 0;
        }
        select {
            padding: 12px 16px; border-radius: 10px; border: 2px solid #2e7d52;
            font-size: 18px; width: 100%; max-width: 320px;
        }
        .start-btn {
            padding: 14px 28px; background: #2e7d52; color: white; border: none;
            border-radius: 10px; cursor: pointer; font-size: 18px; font-weight: bold; transition: all 0.3s;
            margin-top: 14px;
        }
        .start-btn:hover { background: #1e5e3b; transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.2);}        
        .exam-section { padding: 12px 0 20px 0; display: none;}
        .subject-name {
            text-align: center; font-size: 22px; font-weight: bold; color: #2e7d52;
            margin-bottom: 13px; padding: 10px; background: #e8f5e9; border-radius: 10px;
        }
        .progress-text { text-align: center; font-weight: bold; color: #2e7d52; margin-bottom: 10px; font-size: 18px;}
        .question-container {
            margin-bottom: 20px; padding: 18px; border: 2px solid #ddd;
            border-radius: 10px; background: #f9f9f9; position: relative; min-height: 140px;
            display: flex; flex-direction: column; align-items: stretch;
            transition: border-color 0.3s;
        }
        .question-header-bar {
            display: flex; align-items: center; gap: 12px; margin-bottom: 10px; width:100%;
        }
        .star-btn {
            background: none; border: none;
            font-size: 30px; color: #ccc; cursor: pointer; transition: all 0.3s;
            margin: 0 0 0 8px; padding:0;
            order: 2;
        }
        .question-text {
            font-size: 22px; color: #2c3e50; font-weight: 600;
            line-height: 1.6; order: 1; flex: 1; padding: 0; margin: 0;
            word-break: break-word;
        }
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 160px;
            margin-top: 10px;
        }
        .option {
            font-size: 20px;
            padding: 14px;
            background: #f8f8f8;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .option:hover { border-color: #2e7d52; background: #f0f8f1;}
        .correct { border-color: #4caf50 !important; border-width: 4px !important; color: #2c3e50; background: #f9f9f9 !important; }
        .incorrect { border-color: #f44336 !important; border-width: 4px !important; color: #2c3e50; background: #f9f9f9 !important; }
        .navigation-bar-fixed-top {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            background: #fff;
            z-index: 30;
            padding: 10px 12px;
            margin: 0 -12px 16px -12px;
            border-bottom: 1px solid #e0e0e0;
            flex-wrap: wrap;
        }
        /* تكبير ازرار التالي والسابق */
        .nav-btn {
            padding: 14px 24px;
            font-size: 20px;
            min-width: 110px;
            background: #2e7d52;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .nav-btn:disabled { background: #cccccc; cursor: not-allowed; }
        .nav-btn:hover:not(:disabled) { background: #1e5e3b; transform: translateY(-3px); }

        .show-featured-btn {
            padding: 10px 16px; font-size: 16px;
            background: #fffbe6; color: #d58500; border: 1px solid #ffb300; border-radius: 10px; cursor: pointer; font-weight: 600;
        }
        .home-btn { background: none; border: none; font-size: 28px; cursor: pointer; padding: 6px 12px; color: #2e7d52; }
        .results-section { padding: 30px; text-align: center; display: none;}
        .results-section h2 { color: #2e7d52; margin-bottom: 18px;}
        .score { font-size: 48px; font-weight: bold; color: #2e7d52; margin: 18px 0; }
        .restart-btn { padding: 14px 34px; background: #2e7d52; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 18px; font-weight: bold; }
        .bottom-back-btn { padding: 12px 20px; background: #2e7d52; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 18px; transition: all 0.3s; display: inline-block; }

        .shake { animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translateX(0);} 20% { transform: translateX(-10px);} 40% { transform: translateX(10px);} 60% { transform: translateX(-10px);} 80% { transform: translateX(10px);} 100% { transform: translateX(0);} }
        .column10-info { background: #e8f5e9; padding: 16px; border-radius: 10px; margin: 11px 0; border-right: 6px solid #2e7d52; font-size: 18px; line-height: 1.6; }
        .loading { text-align: center; padding: 20px; font-size: 18px; color: #2e7d52; }

        /* تجاوب على الشاشات الصغيرة: تقليل بعض الأحجام لكن تبقى أكبر من الأصل */
        @media (max-width: 600px) {
            :root { --base-font-size: 20px; }
            .nav-btn { min-width: 86px; padding: 10px 16px; font-size: 16px; }
            .start-btn, .restart-btn, .bottom-back-btn { font-size: 16px; padding: 10px 20px; }
            .option { font-size: 16px; padding: 10px; }
            .slider::-webkit-slider-thumb, .slider::-moz-range-thumb { width: 28px; height: 28px; }
        }
    </style>
</head>
<body>
<audio id="click-audio" src="https://cdn.pixabay.com/audio/2022/11/16/audio_12bfa6f1e1.mp3"></audio>
<div class="container">
    <header>
        <h1>WAY</h1>
    </header>
    <div class="content-wrap">
        <div class="loading" id="loading">
            <i class="fas fa-spinner fa-spin"></i> جاري تحميل بيانات الاختبار...
        </div>
        <div class="subject-selection" id="subject-section" style="display: none;">
            <h2>اختر المادة:</h2>
            <div class="selection-container">
                <select id="subject-select"></select>
                <div class="column10-info" id="column10-info"></div>
            </div>
            <button class="start-btn" id="start-btn">بدء الاختبار</button>
        </div>
        <div class="exam-section" id="exam-section">
            <div class="subject-name" id="subject-name"></div>
            <div class="progress-text">السؤال <span id="current-q">1</span> من <span id="total-qs">0</span></div>
            <div class="progress-slider-bar">
                <div class="slider-labels left"><span>1</span></div>
                <input type="range" min="1" max="10" value="10" class="slider" id="question-slider">
                <div class="slider-labels right"><span id="max-question">10</span></div>
            </div>
            <div class="navigation-bar-fixed-top" id="nav-top-bar">
                <button class="nav-btn" id="prev-btn" disabled>السابق</button>
                <button class="nav-btn" id="next-btn">التالي</button>
                <button class="show-featured-btn" id="show-featured-btn" title="عرض المميزة"><i class="fa-regular fa-star"></i> عرض المميزة</button>
                <button class="home-btn" id="nav-home-btn" title="الصفحة الرئيسية"><i class="fas fa-home"></i></button>
            </div>
            <div class="question-container" id="question-container">
                <div class="question-header-bar">
                    <button class="star-btn" id="star-btn" title="تمييز السؤال">
                        <i class="fa-regular fa-star"></i>
                    </button>
                    <div class="question-text" id="question-text"></div>
                </div>
                <div class="options-container" id="options-container"></div>
            </div>
            <button class="bottom-back-btn" id="bottom-back-btn" style="display:none">
                <i class="fas fa-home"></i> العودة للبداية
            </button>
        </div>
        <div class="results-section" id="results-section">
            <h2>لقد أكملت الاختبار!</h2>
            <p>درجتك النهائية هي:</p>
            <div class="score" id="score">0/0</div>
            <button class="restart-btn" id="restart-btn">إعادة الاختبار</button>
            <button class="bottom-back-btn" id="results-back-btn">
                <i class="fas fa-home"></i> العودة للبداية
            </button>
        </div>
    </div>
</div>
<script>
/* نفس سكربت التطبيق الأصلي - لم يتم تغيير المنطق، فقط تم الحفاظ على التوافق مع الواجهة الأكبر */
document.addEventListener('DOMContentLoaded', function() {
    const loadingElement = document.getElementById('loading');
    const subjectSection = document.getElementById('subject-section');
    const subjectSelect = document.getElementById('subject-select');
    const column10Info = document.getElementById('column10-info');
    const startBtn = document.getElementById('start-btn');
    const examSection = document.getElementById('exam-section');
    const subjectNameElement = document.getElementById('subject-name');
    const resultsSection = document.getElementById('results-section');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const currentQ = document.getElementById('current-q');
    const totalQs = document.getElementById('total-qs');
    const scoreElement = document.getElementById('score');
    const restartBtn = document.getElementById('restart-btn');
    const bottomBackBtn = document.getElementById('bottom-back-btn');
    const resultsBackBtn = document.getElementById('results-back-btn');
    const questionSlider = document.getElementById('question-slider');
    const maxQuestionLabel = document.getElementById('max-question');
    const starBtn = document.getElementById('star-btn');
    const showFeaturedBtn = document.getElementById('show-featured-btn');
    const navHomeBtn = document.getElementById('nav-home-btn');
    const questionContainer = document.getElementById('question-container');
    const clickAudio = document.getElementById('click-audio');
    let questionsData = [];
    let currentSubject = '';
    let currentQuestions = [];
    let currentQuestionIndex = 0;
    let userAnswers = [];
    let starredQuestions = [];
    let subjectColumn10 = {};
    let showOnlyStarred = false;
    const excelFileURL = "https://webdr-creator.github.io/Excel/MCQ5.xlsx";

    function getStarStorageKey(subject) { return `starredQuestions_${subject}`; }
    function loadStarredQuestions(subject) { try { const saved = localStorage.getItem(getStarStorageKey(subject)); if (saved) { starredQuestions = JSON.parse(saved);} else { starredQuestions = []; } } catch (e) { starredQuestions = []; } }
    function saveStarredQuestions(subject) { localStorage.setItem(getStarStorageKey(subject), JSON.stringify(starredQuestions)); }

    loadExcelFile(excelFileURL);
    function loadExcelFile(url) {
        loadingElement.style.display = 'block';
        fetch(url)
            .then(response => { if (!response.ok) throw new Error('حدث خطأ في تحميل الملف'); return response.arrayBuffer(); })
            .then(data => { processExcelData(data); loadingElement.style.display = 'none'; subjectSection.style.display = 'block'; })
            .catch(error => { console.error('Error:', error); loadingElement.innerHTML = '<p style="color: red;">فشل في تحميل ملف Excel. يرجى التحقق من الاتصال بالإنترنت.</p>'; });
    }
    function processExcelData(data) {
        const workbook = XLSX.read(data, { type: 'array' });
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
        questionsData = [];
        const subjects = new Set();
        subjectColumn10 = {};
        const startRow = jsonData[0].length > 0 && isNaN(jsonData[0][0]) ? 1 : 0;
        for (let i = startRow; i < jsonData.length; i++) {
            const row = jsonData[i];
            if (!row || row.length < 7) continue;
            const question = {
                text: row[0] || 'بدون نص',
                options: [],
                correctAnswer: parseInt(row[6]) || 1,
                subject: row[8] || 'عام',
                id: i
            };
            for (let j = 1; j <= 5; j++) { if (row[j]) question.options.push(row[j]); }
            if (question.options.length === 0) { question.options.push('نعم'); question.options.push('لا'); }
            questionsData.push(question);
            subjects.add(question.subject);
            if (row[9] && !subjectColumn10[question.subject]) { subjectColumn10[question.subject] = row[9]; }
        }
        subjectSelect.innerHTML = '';
        subjects.forEach(subject => { const option = document.createElement('option'); option.value = subject; option.textContent = subject; subjectSelect.appendChild(option); });
        currentSubject = subjectSelect.value;
        updateColumn10Info();
        loadStarredQuestions(currentSubject);
    }
    function updateColumn10Info() { const info = subjectColumn10[currentSubject] || 'لا توجد معلومات إضافية'; column10Info.textContent = info; }
    subjectSelect.addEventListener('change', function() { currentSubject = this.value; updateColumn10Info(); loadStarredQuestions(currentSubject); if (examSection.style.display === 'block') updateStarButton(); });
    startBtn.addEventListener('click', function() {
        currentSubject = subjectSelect.value;
        currentQuestions = questionsData.filter(q => q.subject === currentSubject);
        if (currentQuestions.length === 0) { alert('لا توجد أسئلة لهذه المادة'); return; }
        userAnswers = new Array(currentQuestions.length).fill(null);
        loadStarredQuestions(currentSubject);
        currentQuestionIndex = 0; showOnlyStarred = false; showFeaturedBtn.classList.remove('active'); showFeaturedBtn.innerHTML = '<i class="fa-regular fa-star"></i> عرض المميزة'; totalQs.textContent = currentQuestions.length; subjectNameElement.textContent = currentSubject; maxQuestionLabel.textContent = currentQuestions.length; questionSlider.max = currentQuestions.length; questionSlider.value = currentQuestions.length; updateProgressAndSlider(); updateStarButton(); showQuestion(); subjectSection.style.display = 'none'; examSection.style.display = 'block';
    });
    function getDisplayedQuestions() { if (showOnlyStarred) { return currentQuestions.filter(q => starredQuestions.includes(q.id)); } return currentQuestions; }
    showFeaturedBtn.addEventListener('click', function() { showOnlyStarred = !showOnlyStarred; this.classList.toggle('active', showOnlyStarred); this.innerHTML = showOnlyStarred ? '<i class="fa-regular fa-star"></i> عرض الكل' : '<i class="fa-regular fa-star"></i> عرض المميزة'; const displayed = getDisplayedQuestions(); if (displayed.length === 0) { questionText.innerHTML = '<p>لا توجد أسئلة مميزة بعد.</p>'; optionsContainer.innerHTML = ''; prevBtn.disabled = true; nextBtn.disabled = true; currentQ.textContent = 0; totalQs.textContent = 0; questionSlider.max = 1; questionSlider.value = currentQuestions.length; updateProgressAndSlider(); } else { currentQuestionIndex = 0; showQuestion(); updateProgressAndSlider(); updateNavigationButtons(); } });
    navHomeBtn.addEventListener('click', function() { subjectSection.style.display = 'block'; examSection.style.display = 'none'; resultsSection.style.display = 'none'; });
    function updateStarButton() { const displayedQuestions = getDisplayedQuestions(); if (displayedQuestions.length === 0) return; const question = displayedQuestions[currentQuestionIndex]; const isStarred = starredQuestions.includes(question.id); const starIcon = starBtn.querySelector('i'); if (isStarred) { starBtn.classList.add('starred'); starIcon.classList.remove('fa-regular'); starIcon.classList.add('fa-solid'); } else { starBtn.classList.remove('starred'); starIcon.classList.remove('fa-solid'); starIcon.classList.add('fa-regular'); } }
    questionSlider.addEventListener('input', function() { const displayed = getDisplayedQuestions(); const newIndex = parseInt(this.value) - 1; if (displayed.length > 0 && newIndex >= 0 && newIndex < displayed.length && newIndex !== currentQuestionIndex) { currentQuestionIndex = newIndex; showQuestion(); updateProgressAndSlider(); updateStarButton(); } });
    starBtn.addEventListener('click', function() { const displayedQuestions = getDisplayedQuestions(); if (displayedQuestions.length === 0) return; const question = displayedQuestions[currentQuestionIndex]; const questionId = question.id; const index = starredQuestions.indexOf(questionId); const starIcon = this.querySelector('i'); if (index === -1) { starredQuestions.push(questionId); this.classList.add('starred'); starIcon.classList.remove('fa-regular'); starIcon.classList.add('fa-solid'); } else { starredQuestions.splice(index, 1); this.classList.remove('starred'); starIcon.classList.remove('fa-solid'); starIcon.classList.add('fa-regular'); } saveStarredQuestions(currentSubject); if (showOnlyStarred) { const displayed = getDisplayedQuestions(); if (displayed.length === 0) { questionText.innerHTML = '<p>لا توجد أسئلة مميزة بعد.</p>'; optionsContainer.innerHTML = ''; prevBtn.disabled = true; nextBtn.disabled = true; currentQ.textContent = 0; totalQs.textContent = 0; questionSlider.max = 1; questionSlider.value = currentQuestions.length; updateProgressAndSlider(); } else { if (currentQuestionIndex >= displayed.length) { currentQuestionIndex = displayed.length - 1; } showQuestion(); updateNavigationButtons(); updateProgressAndSlider(); } } });
    function showQuestion() {
        const displayedQuestions = getDisplayedQuestions();
        if (displayedQuestions.length === 0) {
            questionText.innerHTML = '<p>لا توجد أسئلة لعرضها.</p>';
            optionsContainer.innerHTML = '';
            prevBtn.disabled = true;
            nextBtn.disabled = true;
            currentQ.textContent = 0;
            totalQs.textContent = 0;
            questionSlider.max = 1;
            questionSlider.value = currentQuestions.length;
            updateProgressAndSlider();
            questionContainer.classList.remove('correct','incorrect');
            return;
        }
        const question = displayedQuestions[currentQuestionIndex];
        questionText.textContent = question.text;
        optionsContainer.innerHTML = '';
        const originalIndex = currentQuestions.findIndex(q => q.id === question.id);
        let isAnswered = userAnswers[originalIndex] !== null;
        questionContainer.classList.remove('correct','incorrect');
        let correctIdx = question.correctAnswer - 1;
        let userSelectedIdx = isAnswered ? userAnswers[originalIndex] - 1 : -1;
        question.options.forEach((option, index) => {
            const optionElement = document.createElement('div');
            optionElement.className = 'option';
            optionElement.textContent = option;
            if (isAnswered) {
                if (index === correctIdx) {
                    if (userSelectedIdx !== correctIdx) {
                        optionElement.classList.add('correct');
                    }
                }
                if (userSelectedIdx === index) {
                    if (userSelectedIdx === correctIdx) { optionElement.classList.add('correct'); } else { optionElement.classList.add('incorrect'); }
                }
            }
            optionElement.addEventListener('click', () => selectOption(index + 1, question.id));
            optionsContainer.appendChild(optionElement);
        });
        for (let i = question.options.length; i < 5; i++) {
            let filler = document.createElement('div');
            filler.className = 'option';
            filler.style.visibility = 'hidden';
            filler.innerHTML = '&nbsp;';
            optionsContainer.appendChild(filler);
        }
        currentQ.textContent = currentQuestionIndex + 1;
        totalQs.textContent = displayedQuestions.length;
        questionSlider.max = displayedQuestions.length;
        questionSlider.value = currentQuestionIndex + 1;
        updateNavigationButtons();
        updateStarButton();
        updateProgressAndSlider();
    }
    function selectOption(optionIndex, questionId) {
        const originalIndex = currentQuestions.findIndex(q => q.id === questionId);
        if (userAnswers[originalIndex] !== null) return;
        playClick();
        userAnswers[originalIndex] = optionIndex;
        const displayedQuestions = getDisplayedQuestions();
        const question = displayedQuestions[currentQuestionIndex];
        const correctIdx = question.correctAnswer - 1;
        const options = optionsContainer.querySelectorAll('.option');
        let isCorrect = optionIndex === question.correctAnswer;
        let isIncorrect = !isCorrect;
        questionContainer.classList.remove('correct','incorrect');

        options.forEach((opt, idx) => {
            if (optionIndex - 1 === idx) {
                if (isCorrect) { opt.classList.add('correct'); } else { opt.classList.add('incorrect'); opt.classList.add('shake'); setTimeout(() => opt.classList.remove('shake'), 500); }
            }
            if (isIncorrect && idx === correctIdx) { opt.classList.add('correct'); }
        });

        if (isIncorrect) {
            options[optionIndex - 1].classList.add('shake');
            setTimeout(() => options[optionIndex - 1].classList.remove('shake'), 500);
            setTimeout(() => { if (currentQuestionIndex < displayedQuestions.length - 1) { currentQuestionIndex++; showQuestion(); updateProgressAndSlider(); } }, 1500);
        } else {
            setTimeout(() => { if (currentQuestionIndex < displayedQuestions.length - 1) { currentQuestionIndex++; showQuestion(); updateProgressAndSlider(); } else { showResults(); } }, 900);
        }
        updateNavigationButtons();
    }
    function updateNavigationButtons() { const displayed = getDisplayedQuestions(); prevBtn.disabled = currentQuestionIndex === 0 || displayed.length === 0; nextBtn.disabled = displayed.length === 0; if (currentQuestionIndex === displayed.length - 1) { nextBtn.textContent = 'إنهاء الاختبار'; } else { nextBtn.textContent = 'التالي'; } }
    prevBtn.addEventListener('click', function() { const displayed = getDisplayedQuestions(); if (currentQuestionIndex > 0 && displayed.length > 0) { currentQuestionIndex--; showQuestion(); updateProgressAndSlider(); updateNavigationButtons(); } });
    nextBtn.addEventListener('click', function() { const displayed = getDisplayedQuestions(); if (currentQuestionIndex < displayed.length - 1) { currentQuestionIndex++; showQuestion(); updateProgressAndSlider(); updateNavigationButtons(); } else { showResults(); } });
    function updateProgressAndSlider() { const displayedQuestions = getDisplayedQuestions(); let percent = 0; if (displayedQuestions.length > 0) percent = 100 - ((currentQuestionIndex + 1) / displayedQuestions.length) * 100; questionSlider.max = displayedQuestions.length; questionSlider.value = currentQuestionIndex + 1; maxQuestionLabel.textContent = displayedQuestions.length; }
    function showResults() { let correct = 0; for (let i = 0; i < currentQuestions.length; i++) { if (userAnswers[i] === currentQuestions[i].correctAnswer) correct++; } scoreElement.textContent = `${correct}/${currentQuestions.length}`; examSection.style.display = 'none'; resultsSection.style.display = 'block'; }
    restartBtn.addEventListener('click', function() { subjectSection.style.display = 'block'; examSection.style.display = 'none'; resultsSection.style.display = 'none'; });
    bottomBackBtn.addEventListener('click', function() { subjectSection.style.display = 'block'; examSection.style.display = 'none'; resultsSection.style.display = 'none'; });
    resultsBackBtn.addEventListener('click', function() { subjectSection.style.display = 'block'; examSection.style.display = 'none'; resultsSection.style.display = 'none'; });
    function playClick() { if (clickAudio) { clickAudio.currentTime = 0; clickAudio.play(); } }
});
</script>
</body>
</html>
